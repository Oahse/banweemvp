{% extends "emails/base_email.html" %}

{% block content %}
<h2>Payment Confirmation</h2>

<p>Hello {{ user_name }},</p>

<p>Thank you! We've successfully processed your payment for your subscription.</p>

<div class="cost-breakdown">
    <h3>Payment Details</h3>
    <div class="cost-item">
        <span>Payment Date:</span>
        <span>{{ payment_date }}</span>
    </div>
    <div class="cost-item">
        <span>Payment Method:</span>
        <span>{{ payment_method }}</span>
    </div>
    <div class="cost-item">
        <span>Subscription ID:</span>
        <span>{{ subscription_id }}</span>
    </div>
</div>

{% if cost_breakdown %}
<div class="cost-breakdown">
    <h3>Cost Breakdown</h3>
    {% if cost_breakdown.variant_costs %}
        {% for variant_cost in cost_breakdown.variant_costs %}
        <div class="cost-item">
            <span>{{ variant_cost.name }}</span>
            <span>{{ variant_cost.price | currency }}</span>
        </div>
        {% endfor %}
    {% endif %}
    
    {% if cost_breakdown.subtotal %}
    <div class="cost-item">
        <span>Subtotal:</span>
        <span>{{ cost_breakdown.subtotal | currency }}</span>
    </div>
    {% endif %}
    
    {% if cost_breakdown.admin_fee %}
    <div class="cost-item">
        <span>Service Fee ({{ cost_breakdown.admin_percentage }}%):</span>
        <span>{{ cost_breakdown.admin_fee | currency }}</span>
    </div>
    {% endif %}
    
    {% if cost_breakdown.delivery_cost %}
    <div class="cost-item">
        <span>Delivery ({{ cost_breakdown.delivery_type }}):</span>
        <span>{{ cost_breakdown.delivery_cost | currency }}</span>
    </div>
    {% endif %}
    
    {% if cost_breakdown.tax_amount %}
    <div class="cost-item">
        <span>Tax ({{ cost_breakdown.tax_rate * 100 }}%):</span>
        <span>{{ cost_breakdown.tax_amount | currency }}</span>
    </div>
    {% endif %}
    
    {% if cost_breakdown.loyalty_discount %}
    <div class="cost-item" style="color: #28a745;">
        <span>Loyalty Discount:</span>
        <span>-{{ cost_breakdown.loyalty_discount | currency }}</span>
    </div>
    {% endif %}
    
    <div class="cost-item cost-total">
        <span>Total Paid:</span>
        <span>{{ payment_amount | currency }}</span>
    </div>
</div>
{% endif %}

<p>Your subscription is now active and you'll receive your next delivery according to your selected schedule.</p>

<div style="text-align: center; margin: 30px 0;">
    <a href="{{ subscription_management_url }}" class="subscription-link">View Subscription Details</a>
</div>

<p>Thank you for choosing {{ company_name }}!</p>

<p>Best regards,<br>
The {{ company_name }} Team</p>
{% endblock %}